{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Generate Hike Letter</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        body { font-family: Arial, sans-serif; background: #f5f5f5; margin: 30px; }
        .container { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #004080; margin-bottom: 20px; }
        label { display: block; margin-top: 15px; font-weight: bold; }
        select, input[type="text"], input[type="date"], input[type="number"] {
            width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ccc; border-radius: 4px;
        }
        button { margin-top: 20px; padding: 10px 15px; background-color: #004080; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { opacity: 0.9; }
        .back-link { display: block; margin-top: 15px; text-align: center; color: #555; text-decoration: none; }
        .back-link:hover { text-decoration: underline; }
        .info { margin-bottom: 10px; font-size: 14px; }
        .error-message { color: #d9534f; font-weight: 500; margin-top: 10px; }
        .success { color: green; font-weight: bold; margin-bottom: 10px; }
        .alert { padding: 10px; border-radius: 4px; margin-bottom: 10px; }
        .alert-error { background: #ffd5d5; color: #b30000; }
        .alert-success { background: #d5ffd8; color: #006600; }
    </style>
</head>

<body>
    <div class="container">
        <h2>Generate Hike Letter</h2>

        <!-- SHOW DJANGO MESSAGES -->
        {% if messages %}
            {% for message in messages %}
                <div class="alert {% if message.tags == 'error' %}alert-error{% else %}alert-success{% endif %}">
                    {{ message }}
                </div>
            {% endfor %}
        {% endif %}

        <div class="info"><strong>Employee:</strong> {{ employee.first_name }} {{ employee.last_name }}</div>
        <div class="info"><strong>Employee Code:</strong>
            {% if employee.hike_letters.last %}
                {{ employee.hike_letters.last.employee_code }}
            {% else %}
                STPL{{ employee.id|stringformat:"03d" }}
            {% endif %}
        </div>
        <div class="info"><strong>Old Package (Per Annum):</strong> ₹{{ old_package }}</div>

        <form method="POST">
            {% csrf_token %}

            <label for="date">Todays Date(Ex: Todays date menas hike is from next from starting):</label>
            <input type="date" name="date" id="date" required
                   min="{{ min_date|date:'Y-m-d' }}"
                   value="{{ min_date|date:'Y-m-d' }}">

            <label for="new_package_month">New Package (Per Month in ₹):</label>
            <input type="number" step="0.01" name="new_package_month" id="new_package_month" required
                   value="{{ new_package_month|default_if_none:'' }}" oninput="calculateAnnual()">

            <div class="info">
                <strong>New Package (Per Annum):</strong> ₹
                <span id="new_package_annual">{{ new_package_annual|default_if_none:'' }}</span>
            </div>

            <input type="hidden" name="new_package_annual" id="new_package_annual_input">

            <button type="submit">Generate Hike Letter</button>
        </form>

        {% if error_message %}
            <div class="error-message">{{ error_message }}</div>
        {% endif %}

        <a href="{% url 'employee_list' %}" class="back-link">← Back to Employee List</a>
    </div>

    <script>
        // Calculate Annual Package
        function calculateAnnual() {
            let monthVal = document.getElementById('new_package_month').value;
            let annualVal = monthVal ? parseFloat(monthVal) * 12 : '';
            let formatted = annualVal ? annualVal.toLocaleString('en-IN', {minimumFractionDigits: 2, maximumFractionDigits: 2}) : '';
            document.getElementById('new_package_annual').innerText = formatted;
            document.getElementById('new_package_annual_input').value = annualVal ? annualVal.toFixed(2) : '';
        }

        window.onload = function() {
            calculateAnnual();

            const dateInput = document.getElementById('date');
            const minDate = dateInput.min;

            // Prevent manual typing of past dates
            dateInput.addEventListener('input', function() {
                if (dateInput.value < minDate) {
                    dateInput.value = minDate;
                }
            });
        };
    </script>
</body>
</html>
